# 查询处理步骤
大体上分为4个阶段:查询分析,查询检查,查询优化和查询执行
## 查询分析
首先对查询语句进行扫描.语法分析和词法分析,判断是否符合SQL规则
## 查询检查
对于合法的查询语句进行予以检查,即关系名,属性名是否存在和有效
## 查询优化
对于表达式进行数学优化,减少时间复杂度
## 查询执行
依据优化器得到的查询执行方案,由代码生成器生成执行这个查询计划的代码然后加以执行,回送结果

查询代价一般用查询处理读写的块数作为衡量的标准

# 代数优化
优化应该遵循以下规则
- 选择运算尽可能先做
- 投影和选择同时进行
- 投影和双目运算结合
- 把某些选择同在他前面执行的笛卡尔积结合起来成为一个链接运算
- 找出公共子表达式

!上面这些都不重要,重要的是怎么优化
SELECT Student.Sname FROM Student, SC WHERE Student.Sno-SC.Sno AND SC.Cno=2';
对于这个句子,我们按照执行的顺序画出它的关系代数树
![[Pasted image 20221209153824.png]]
然后我们按照以上规则进行优化,选择运算尽量先做,也就是cno=2移到下面,然后再做自然连接

```mysql
SELECT S.sno,sname 
FROM S,SC,C 
WHERE tname=‘刘利’AND sex=‘女’ AND
               S.sno=SC.sno AND SC.cno=C.cno
```
我们先写出这个表达式的代数表达式
![[Pasted image 20221209154318.png]]
然后我们可以设置这几个选择条件为f1,f2...
![[Pasted image 20221209154348.png]]
 ![[Pasted image 20221209154507.png]]
 然后我们将选择关系向叶子顶点移动![[Pasted image 20221209154633.png]]
 ![[Pasted image 20221209154756.png]]
 ![[Pasted image 20221209154834.png]]
  